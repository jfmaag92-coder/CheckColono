<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>CheckColono</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        sans-serif;
      line-height: 1.4;
    }
    body {
      margin: 0;
      padding: 0;
      background: #f5f5f7;
      color: #222;
      display: flex;
      justify-content: center;
    }
    .app-container {
      max-width: 480px;
      width: 100%;
      padding: 16px;
    }
    .card {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
      padding: 20px;
      margin-bottom: 16px;
    }
    h1, h2 {
      margin: 0 0 12px 0;
      font-weight: 600;
    }

    /* ---------- PLAN DE PREPARACIN ---------- */

    .prep-steps {
      margin-top: 8px;
      position: relative;
    }

    /* l铆nea vertical del timeline */
    .prep-steps::before {
      content: "";
      position: absolute;
      left: 10px;
      top: 4px;
      bottom: 4px;
      width: 2px;
      background: #e1e5f0;
    }

    .prep-step {
      margin-bottom: 16px;
      padding-left: 28px;
      position: relative;
    }

    /* punto azul */
    .prep-step::before {
      content: "";
      position: absolute;
      left: 5px;
      top: 4px;
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: #0b6eff;
      box-shadow: 0 0 0 3px rgba(11,110,255,0.2);
    }

    .prep-time {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 2px;
    }

    .prep-desc {
      font-size: 1rem;
      color: #222;
      line-height: 1.35;
    }

    /* estilo discreto del link EN LNEA */
    .prep-desc a,
    .inline-link {
      display: inline;              /* clave para que no baje de rengl贸n */
      color: #0066cc;
      text-decoration: underline;
      text-underline-offset: 2px;
      font-weight: 500;
    }

    .inline-link:hover {
      opacity: 0.8;
    }

    .plan-footer {
      margin-top: 20px;
    }

    .export-btn {
      display: block;
      width: 100%;
      padding: 12px 16px;
      border-radius: 12px;
      border: none;
      background: #e6f0ff;
      color: #0052cc;
      font-weight: 600;
      text-align: center;
      cursor: pointer;
    }

    .export-btn:active {
      transform: scale(0.98);
    }
  </style>
</head>
<body>
  <div class="app-container">

    <!-- otras cards de arriba (selector de esquema, bot贸n Generar, etc.) -->

    <div class="card" id="plan-card" style="display:none;">
      <h2>Tu plan de preparaci贸n</h2>
      <div id="prep-steps" class="prep-steps"></div>

      <div class="plan-footer">
        <button class="export-btn" id="export-ics">
          Exportar plan a calendario (.ics)
        </button>
      </div>
    </div>
  </div>

  <script>
    // --------- EJEMPLO DE GENERACIN DEL PLAN ---------
    // Supongamos que ya calculaste las fechas/horas y armaste este array:
    // textBefore = lo que va antes del link
    // linkText / linkHref = link
    // textAfter = lo que va despu茅s (ej: el punto final)

    const examplePlan = [
      {
        datetime: new Date(2025, 11, 14, 9, 0), // ojo: mes 11 = diciembre
        textBefore: "Iniciar ",
        linkText: "dieta baja en residuos",
        linkHref: "#",
        textAfter: "."
      },
      {
        datetime: new Date(2025, 11, 16, 9, 0),
        textBefore: "Iniciar ",
        linkText: "dieta de l铆quidos claros",
        linkHref: "#",
        textAfter: "."
      },
      {
        datetime: new Date(2025, 11, 16, 20, 0),
        text: "Primera dosis de soluci贸n de PEG."
      },
      {
        datetime: new Date(2025, 11, 17, 13, 7),
        text: "Iniciar ayuno de s贸lidos."
      },
      {
        datetime: new Date(2025, 11, 17, 14, 7),
        text: "Segunda dosis de soluci贸n de PEG."
      },
      {
        datetime: new Date(2025, 11, 17, 17, 7),
        text: "Presentarse en el centro m茅dico."
      }
    ];

    function formatDateTime(date) {
      // formato corto parecido al de iOS: "mi茅 17-12, 05:07 p. m."
      const dias = ["dom", "lun", "mar", "mi茅", "jue", "vie", "s谩b"];
      const dia = dias[date.getDay()];
      const dd = String(date.getDate()).padStart(2, "0");
      const mm = String(date.getMonth() + 1).padStart(2, "0");

      let hours = date.getHours();
      const minutes = String(date.getMinutes()).padStart(2, "0");
      const isPM = hours >= 12;
      let label = isPM ? "p. m." : "a. m.";
      hours = hours % 12;
      if (hours === 0) hours = 12;

      return `${dia} ${dd}-${mm}, ${hours}:${minutes} ${label}`;
    }

    function renderPlan(steps) {
      const container = document.getElementById("prep-steps");
      container.innerHTML = "";

      steps.forEach(step => {
        const wrapper = document.createElement("div");
        wrapper.className = "prep-step";

        const timeEl = document.createElement("div");
        timeEl.className = "prep-time";
        timeEl.textContent = formatDateTime(step.datetime);

        const descEl = document.createElement("div");
        descEl.className = "prep-desc";

        if (step.linkText && step.linkHref) {
          if (step.textBefore) {
            descEl.appendChild(
              document.createTextNode(step.textBefore)
            );
          }

          const a = document.createElement("a");
          a.href = step.linkHref;
          a.className = "inline-link";
          a.textContent = step.linkText;
          descEl.appendChild(a);

          if (step.textAfter) {
            descEl.appendChild(
              document.createTextNode(step.textAfter)
            );
          }
        } else {
          descEl.textContent = step.text;
        }

        wrapper.appendChild(timeEl);
        wrapper.appendChild(descEl);
        container.appendChild(wrapper);
      });

      // Mostrar la card
      document.getElementById("plan-card").style.display = "block";
    }

    // Llam谩s a esto cuando el usuario toca "Generar plan"
    renderPlan(examplePlan);

    // ac谩 ir铆a tu l贸gica real de exportar ICS
    document.getElementById("export-ics").addEventListener("click", () => {
      alert("Ac谩 va la generaci贸n del .ics ");
    });
  </script>
</body>
</html>
