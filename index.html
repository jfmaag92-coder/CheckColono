<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>CheckColono</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        sans-serif;
      line-height: 1.4;
    }
    body {
      margin: 0;
      padding: 0;
      background: #f5f5f7;
      color: #222;
      display: flex;
      justify-content: center;
    }
    .app-container {
      max-width: 480px;
      width: 100%;
      padding: 16px;
    }
    .card {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
      padding: 20px;
      margin-bottom: 16px;
    }
    h1, h2 {
      margin: 0 0 12px 0;
      font-weight: 600;
    }

    /* ---------- CARD CONFIGURACIN ---------- */

    .form-group {
      margin-bottom: 12px;
    }

    label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 4px;
      color: #555;
    }

    select, input[type="datetime-local"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #d0d5e0;
      font-size: 0.95rem;
      box-sizing: border-box;
    }

    .primary-btn {
      display: block;
      width: 100%;
      padding: 12px 16px;
      border-radius: 999px;
      border: none;
      background: #007aff;
      color: #ffffff;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 8px;
    }

    .primary-btn:active {
      transform: scale(0.98);
    }

    /* ---------- PLAN DE PREPARACIN ---------- */

    .prep-steps {
      margin-top: 8px;
      position: relative;
    }

    /* l铆nea vertical del timeline */
    .prep-steps::before {
      content: "";
      position: absolute;
      left: 10px;
      top: 4px;
      bottom: 4px;
      width: 2px;
      background: #e1e5f0;
    }

    .prep-step {
      margin-bottom: 16px;
      padding-left: 28px;
      position: relative;
    }

    /* punto azul */
    .prep-step::before {
      content: "";
      position: absolute;
      left: 5px;
      top: 4px;
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: #0b6eff;
      box-shadow: 0 0 0 3px rgba(11,110,255,0.2);
    }

    .prep-time {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 2px;
    }

    .prep-desc {
      font-size: 1rem;
      color: #222;
      line-height: 1.35;
    }

    /* estilo discreto del link EN LNEA */
    .prep-desc a,
    .inline-link {
      display: inline;
      color: #0066cc;
      text-decoration: underline;
      text-underline-offset: 2px;
      font-weight: 500;
    }

    .inline-link:hover {
      opacity: 0.8;
    }

    .plan-footer {
      margin-top: 20px;
    }

    .export-btn {
      display: block;
      width: 100%;
      padding: 12px 16px;
      border-radius: 12px;
      border: none;
      background: #e6f0ff;
      color: #0052cc;
      font-weight: 600;
      text-align: center;
      cursor: pointer;
    }

    .export-btn:active {
      transform: scale(0.98);
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- CARD CONFIGURACIN -->
    <div class="card">
      <h1>CheckColono</h1>

      <div class="form-group">
        <label for="regimen">Esquema de preparaci贸n</label>
        <select id="regimen">
          <option value="peg-dividido">PEG en dosis divididas (ejemplo)</option>
        </select>
      </div>

      <div class="form-group">
        <label for="procedimiento">Fecha y hora del estudio</label>
        <input type="datetime-local" id="procedimiento">
      </div>

      <button class="primary-btn" id="btn-generar">
        Generar plan
      </button>
    </div>

    <!-- CARD PLAN DE PREPARACIN -->
    <div class="card" id="plan-card" style="display:none;">
      <h2>Tu plan de preparaci贸n</h2>
      <div id="prep-steps" class="prep-steps"></div>

      <div class="plan-footer">
        <button class="export-btn" id="export-ics">
          Exportar plan a calendario (.ics)
        </button>
      </div>
    </div>
  </div>

  <script>
    // genera un plan de ejemplo a partir de la fecha del estudio
    function buildExamplePlan(baseDate) {
      // si no hay fecha elegida, uso hoy a la ma帽ana solo para demo
      const estudio = baseDate ? new Date(baseDate) : new Date();

      // para ejemplo: resto d铆as/horas a mano
      const d1 = new Date(estudio.getTime());
      d1.setDate(d1.getDate() - 3);
      d1.setHours(9, 0, 0, 0);

      const d2 = new Date(estudio.getTime());
      d2.setDate(d2.getDate() - 1);
      d2.setHours(9, 0, 0, 0);

      const d3 = new Date(estudio.getTime());
      d3.setDate(d3.getDate() - 1);
      d3.setHours(20, 0, 0, 0);

      const d4 = new Date(estudio.getTime());
      d4.setHours(d4.getHours() - 8);

      const d5 = new Date(estudio.getTime());
      d5.setHours(d5.getHours() - 6);

      const d6 = new Date(estudio.getTime());

      return [
        {
          datetime: d1,
          textBefore: "Iniciar ",
          linkText: "dieta baja en residuos",
          linkHref: "#",
          textAfter: "."
        },
        {
          datetime: d2,
          textBefore: "Iniciar ",
          linkText: "dieta de l铆quidos claros",
          linkHref: "#",
          textAfter: "."
        },
        {
          datetime: d3,
          text: "Primera dosis de soluci贸n de PEG."
        },
        {
          datetime: d4,
          text: "Iniciar ayuno de s贸lidos."
        },
        {
          datetime: d5,
          text: "Segunda dosis de soluci贸n de PEG."
        },
        {
          datetime: d6,
          text: "Presentarse en el centro m茅dico."
        }
      ];
    }

    function formatDateTime(date) {
      const dias = ["dom", "lun", "mar", "mi茅", "jue", "vie", "s谩b"];
      const dia = dias[date.getDay()];
      const dd = String(date.getDate()).padStart(2, "0");
      const mm = String(date.getMonth() + 1).padStart(2, "0");

      let hours = date.getHours();
      const minutes = String(date.getMinutes()).padStart(2, "0");
      const isPM = hours >= 12;
      let label = isPM ? "p. m." : "a. m.";
      hours = hours % 12;
      if (hours === 0) hours = 12;

      return `${dia} ${dd}-${mm}, ${hours}:${minutes} ${label}`;
    }

    function renderPlan(steps) {
      const container = document.getElementById("prep-steps");
      container.innerHTML = "";

      steps.forEach(step => {
        const wrapper = document.createElement("div");
        wrapper.className = "prep-step";

        const timeEl = document.createElement("div");
        timeEl.className = "prep-time";
        timeEl.textContent = formatDateTime(step.datetime);

        const descEl = document.createElement("div");
        descEl.className = "prep-desc";

        if (step.linkText && step.linkHref) {
          if (step.textBefore) {
            descEl.appendChild(document.createTextNode(step.textBefore));
          }
          const a = document.createElement("a");
          a.href = step.linkHref;
          a.className = "inline-link";
          a.textContent = step.linkText;
          descEl.appendChild(a);
          if (step.textAfter) {
            descEl.appendChild(document.createTextNode(step.textAfter));
          }
        } else {
          descEl.textContent = step.text;
        }

        wrapper.appendChild(timeEl);
        wrapper.appendChild(descEl);
        container.appendChild(wrapper);
      });

      document.getElementById("plan-card").style.display = "block";
    }

    // bot贸n "Generar plan"
    document.getElementById("btn-generar").addEventListener("click", () => {
      const fechaEstudio = document.getElementById("procedimiento").value;
      const plan = buildExamplePlan(fechaEstudio);
      renderPlan(plan);
      // opcional: hacer scroll a la card del plan
      document.getElementById("plan-card").scrollIntoView({ behavior: "smooth" });
    });

    // bot贸n .ics (placeholder)
    document.getElementById("export-ics").addEventListener("click", () => {
      alert("Ac谩 va la generaci贸n del .ics ");
    });
  </script>
</body>
</html>
